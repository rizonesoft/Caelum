(()=>{"use strict";var e,t,n,o,i,r,E,s,a,c,I,T;!function(e){e.STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object"}(e||(e={})),function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"}(t||(t={})),function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"}(n||(n={})),function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"}(o||(o={})),function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"}(i||(i={})),function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"}(r||(r={})),function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"}(E||(E={})),function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.OTHER="OTHER"}(s||(s={})),function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"}(a||(a={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"}(c||(c={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"}(I||(I={})),Error,function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"}(T||(T={})),s.RECITATION,s.SAFETY,s.LANGUAGE,"function"==typeof SuppressedError&&SuppressedError;const O="ai_compose_settings",_="glide_settings",N={apiKey:"",defaultModel:"gemini-3-flash-preview",defaultTone:"professional",defaultSummaryStyle:"bullets",defaultLanguage:"English"};let u=null;let A=function(e){return e.INVALID_API_KEY="INVALID_API_KEY",e.QUOTA_EXCEEDED="QUOTA_EXCEEDED",e.RATE_LIMITED="RATE_LIMITED",e.NETWORK_ERROR="NETWORK_ERROR",e.TIMEOUT="TIMEOUT",e.CONTENT_FILTERED="CONTENT_FILTERED",e.UNKNOWN="UNKNOWN",e}({});class f extends Error{constructor(e,t,n=!1,o){super(e),this.name="GeminiError",this.code=t,this.retryable=n,this.statusCode=o,Object.setPrototypeOf(this,f.prototype)}}async function l(e,t={}){const n=function(){throw new f("Gemini client not initialised. Call initGeminiClient(apiKey) first.",A.INVALID_API_KEY)}(),o=t.model??function(){if(u)return{...u};try{let e=localStorage.getItem(O);if(!e){const t=localStorage.getItem(_);t&&(e=t,localStorage.setItem(O,t),localStorage.removeItem(_))}if(e){const t=JSON.parse(e);u={...N,...t}}else u={...N}}catch{u={...N}}return{...u}}().defaultModel??"gemini-3-flash-preview";const i={temperature:t.temperature??1,maxOutputTokens:t.maxOutputTokens??2048,topP:t.topP??.95,topK:t.topK??40},r=n.getGenerativeModel({model:o,generationConfig:i});return async function(e){let t,n=1e3;for(let o=0;o<=3;o++)try{return await e()}catch(e){if(t=e instanceof f?e:C(e),!t.retryable||3===o)throw t;const i=.3*Math.random()*n;await R(n+i),n*=2}throw t}(()=>async function(e,t){try{const o=(await(n=e.generateContent(t),new Promise((e,t)=>{const o=setTimeout(()=>{t(new f("Request timed out after 30s. Check your network connection.",A.TIMEOUT,!0))},3e4);n.then(t=>{clearTimeout(o),e(t)}).catch(e=>{clearTimeout(o),t(e)})}))).response.text();if(!o||0===o.trim().length)throw new f("The model returned an empty response. The content may have been filtered.",A.CONTENT_FILTERED);return o}catch(e){throw C(e)}var n}(r,e))}function C(e){if(e instanceof f)return e;const t=e instanceof Error?e.message:String(e),n=function(e){if(e&&"object"==typeof e){const t=e;if("number"==typeof t.status)return t.status;if("number"==typeof t.statusCode)return t.statusCode;if("number"==typeof t.code)return t.code;if(t.response&&"object"==typeof t.response){const e=t.response;if("number"==typeof e.status)return e.status}}}(e);return 401===n||403===n||/api.?key/i.test(t)?new f("Invalid or expired API key. Please check your GEMINI_API_KEY.",A.INVALID_API_KEY,!1,n):429===n||/rate.?limit/i.test(t)||/too many requests/i.test(t)?new f("Rate limited by the Gemini API. Retrying with backoff…",A.RATE_LIMITED,!0,429):429===n&&/quota/i.test(t)?new f("API quota exceeded. Check your billing and quota settings in the Google Cloud Console.",A.QUOTA_EXCEEDED,!1,429):/network/i.test(t)||/fetch failed/i.test(t)||/ECONNREFUSED/i.test(t)||/ENOTFOUND/i.test(t)||/offline/i.test(t)?new f("Network error — please check your internet connection.",A.NETWORK_ERROR,!0):/safety/i.test(t)||/blocked/i.test(t)||/filter/i.test(t)?new f("The response was blocked by content safety filters.",A.CONTENT_FILTERED,!1):n&&n>=500?new f(`Server error (${n}). Retrying…`,A.UNKNOWN,!0,n):new f(`Unexpected error: ${t}`,A.UNKNOWN,!1,n)}function R(e){return new Promise(t=>setTimeout(t,e))}const m={fix_grammar:"Fix grammar, spelling, and punctuation errors",improve_clarity:"Improve clarity and readability",make_concise:"Make the text more concise — remove unnecessary words",make_professional:"Make the tone more professional and polished"};async function S(e,t){const n=Office.context.mailbox.item;if(n)try{const o=await function(e){return new Promise((t,n)=>{"function"==typeof e.getSelectedDataAsync?e.getSelectedDataAsync(Office.CoercionType.Text,e=>{e.status===Office.AsyncResultStatus.Succeeded?t(e.value?.data||""):n(new Error(e.error?.message||"Failed to read selected text"))}):n(new Error("Selection API not available. Ensure you are in compose mode."))})}(n);if(!o.trim())return void p("Please select some text first.",t);const i=function(e,t){let n=e;for(const[e,o]of Object.entries(t)){const t=`{{${e}}}`;n=n.split(t).join(o)}return n}("You are a professional writing assistant.\n\nImprove the following text:\n\n---\n{{TEXT}}\n---\n\nFocus on: {{IMPROVEMENT_FOCUS}}\n\nRequirements:\n- Fix grammar, spelling, and punctuation errors\n- Improve clarity and readability\n- Maintain the original meaning and intent\n- Keep the same general length unless brevity improves the text\n- Return only the improved text, no explanations or annotations",{TEXT:o,IMPROVEMENT_FOCUS:m[e]}),r=await l(i,{temperature:.3,maxOutputTokens:2048});await function(e,t){return new Promise((n,o)=>{e.body&&"function"==typeof e.body.setSelectedDataAsync?e.body.setSelectedDataAsync(t,{coercionType:Office.CoercionType.Text},e=>{e.status===Office.AsyncResultStatus.Succeeded?n():o(new Error(e.error?.message||"Failed to replace text"))}):o(new Error("Cannot write to compose body."))})}(n,r),p("✓ Text improved",t)}catch(e){p(`Error: ${e?.message||"Failed to improve text."}`,t)}else p("No email is open.",t)}function p(e,t){const n=Office.context.mailbox.item;n&&n.notificationMessages.replaceAsync("AIComposeNotification",{type:Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,message:e,icon:"Icon.16x16",persistent:!1}),t.completed()}function d(e){S("fix_grammar",e)}function D(e){S("improve_clarity",e)}function M(e){S("make_concise",e)}function L(e){S("make_professional",e)}Office.onReady(()=>{Office.actions.associate("fixGrammar",d),Office.actions.associate("improveClarity",D),Office.actions.associate("makeConcise",M),Office.actions.associate("makeProfessional",L)})})();
//# sourceMappingURL=commands.js.map